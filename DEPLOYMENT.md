# دليل نشر لوحة تحكم متجرنا

يشرح هذا الدليل كيفية نشر لوحة تحكم متجرنا على البيئة الحالية المكونة من Appsmith و NocoDB و n8n.

## الخطوة 1: تحضير البيئة

### التأكد من تشغيل الخدمات

تأكد من أن جميع الحاويات (Containers) تعمل بشكل صحيح:

```bash
docker ps
```

يجب أن ترى الحاويات التالية قيد التشغيل:
- `appsmith` - خادم Appsmith
- `postgres` - قاعدة البيانات
- `nocodb` - خادم NocoDB
- `n8n` - خادم أتمتة n8n

### التأكد من الوصول إلى الواجهات

1. واجهة Appsmith: `https://build.elshin.cloud`
2. واجهة NocoDB: `https://base.elshin.cloud`
3. واجهة n8n: `https://hq.elshin.cloud`

## الخطوة 2: استخراج المستودع

قم بنسخ المستودع إلى جهازك المحلي:

```bash
git clone https://github.com/ElshinQ/matjarna-appsmith-dashboard.git
cd matjarna-appsmith-dashboard
```

## الخطوة 3: إعداد الاتصال بقاعدة البيانات في Appsmith

1. قم بتسجيل الدخول إلى واجهة Appsmith
2. انتقل إلى Data Sources → Create new → PostgreSQL
3. قم بإنشاء مصدري بيانات:

   **قاعدة بيانات المتجر:**
   ```
   Name: matjarnaDB
   Host: postgres
   Port: 5432
   Database Name: matjarna_db
   Username: noor
   Password: MyDB123456
   ```

   **قاعدة بيانات المستخدمين:**
   ```
   Name: authDB
   Host: postgres
   Port: 5432
   Database Name: auth_db
   Username: noor
   Password: MyDB123456
   ```

4. اختبر الاتصال بالضغط على "Test" والتأكد من نجاح الاتصال

## الخطوة 4: استيراد تطبيق Appsmith

1. من لوحة التحكم الرئيسية، اضغط على "Import"
2. قم بتحميل ملف `appsmith-export.json` (يمكنك إنشاء هذا الملف بالنقر على الرابط أدناه)

```bash
# إنشاء ملف التصدير
cd appsmith
zip -r ../appsmith-export.json .
```

3. أكمل عملية الاستيراد باتباع التعليمات على الشاشة

## الخطوة 5: ربط ملفات JavaScript

1. انتقل إلى صفحة JS Objects في تطبيق Appsmith
2. قم بإنشاء JS Objects جديدة تستند إلى الملفات التالية:
   - `appsmith/js/DatabaseIntegration.js`
   - `appsmith/js/ChatBotIntegration.js`
   - `appsmith/js/N8nIntegration.js`

## الخطوة 6: إعداد تدفقات العمل في n8n

1. قم بتسجيل الدخول إلى واجهة n8n
2. انتقل إلى Workflows → Import From File
3. قم باستيراد ملف `n8n-workflows/low-stock-alert.json`
4. قم بتكوين متغيرات البيئة المطلوبة:
   - `TELEGRAM_BOT_TOKEN`
   - `TELEGRAM_CHAT_ID`
5. قم بتنشيط سير العمل

## الخطوة 7: تخصيص الإعدادات

### تكوين OpenAI API لروبوت الدردشة

1. انتقل إلى إعدادات التطبيق في Appsmith
2. قم بإنشاء متغير تخزين عام باسم `OPENAI_API_KEY`
3. أدخل مفتاح API الخاص بك من OpenAI

### تعديل روابط n8n

قد تحتاج إلى تحديث عناوين URL في ملف `N8nIntegration.js` إذا كانت مختلفة عن الإعدادات الافتراضية.

## الخطوة 8: اختبار النظام

### اختبار لوحة التحكم

1. تصفح لوحة التحكم الرئيسية وتأكد من عرض البيانات بشكل صحيح
2. قم بفتح صفحة المنتجات والتأكد من ظهور قائمة المنتجات

### اختبار تنبيهات المخزون المنخفض

1. قم بتحديث كمية منتج ليكون أقل من حد المخزون المنخفض
2. تأكد من إرسال التنبيه عبر n8n

### اختبار روبوت الدردشة

1. افتح واجهة الدردشة
2. اطرح سؤالاً حول توفر منتج معين
3. تأكد من تلقي إجابة مناسبة

## استكشاف الأخطاء وإصلاحها

### مشاكل استيراد Appsmith

إذا واجهت مشاكل في استيراد التكوين، يمكنك إنشاء التطبيق يدويًا باستخدام الملفات JSON الفردية لكل صفحة.

### مشاكل اتصال قاعدة البيانات

1. تأكد من أن Appsmith وقاعدة بيانات PostgreSQL في نفس شبكة Docker
2. تحقق من بيانات اعتماد قاعدة البيانات
3. تأكد من أن المضيف هو اسم حاوية Docker (`postgres`) وليس localhost

### مشاكل تكامل n8n

1. تحقق من تنشيط Webhook في سير العمل
2. تأكد من صحة عناوين URL في ملف `N8nIntegration.js`

## تحديث النظام

لتحديث النظام بعد إجراء تغييرات على المستودع:

1. قم بتحديث المستودع المحلي
```bash
git pull
```

2. أعد استيراد تكوين Appsmith أو قم بتحديث الملفات يدويًا
3. حدّث تدفقات العمل في n8n حسب الحاجة

## الدعم الفني

إذا واجهت أي مشكلة خلال عملية النشر، يرجى فتح issue في المستودع أو التواصل مع المطور على البريد الإلكتروني المحدد في ملف INSTALLATION.md.
